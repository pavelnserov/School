---
- name: Task 2
  hosts: nodes
  vars:
    users:
    - username: Alice
      password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66326365366138393564323337386631613262643438333661353034656163643136393562373837
          6266366538383063316333646263303665313766303433360a643965353466316263333934656334
          63363966653537366534306232313735353935393237343730666239356362376366346465646532
          6633333632386337650a313230346534393833653638373034396634396138316630656535323930
          3138
    - username: Bob
      password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66326365366138393564323337386631613262643438333661353034656163643136393562373837
          6266366538383063316333646263303665313766303433360a643965353466316263333934656334
          63363966653537366534306232313735353935393237343730666239356362376366346465646532
          6633333632386337650a313230346534393833653638373034396634396138316630656535323930
          3138
    - username: Carol
      password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66326365366138393564323337386631613262643438333661353034656163643136393562373837
          6266366538383063316333646263303665313766303433360a643965353466316263333934656334
          63363966653537366534306232313735353935393237343730666239356362376366346465646532
          6633333632386337650a313230346534393833653638373034396634396138316630656535323930
          3138

  tasks:
     - name: Create users
       user:
         name: "{{ item.username }}"
         shell: /bin/bash
         createhome: yes
         generate_ssh_key: yes
         ssh_key_bits: 2048
         password: "{{ item.password | password_hash('sha512') }}"
         update_password: on_create
         state: present
         comment: "{{ item.username }}@epam.com"
         home: "/home/{{ item.username }}"
       with_items: "{{ users }}"
  
